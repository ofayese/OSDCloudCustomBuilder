{
  "name": "PowerShell Module Dev",
  "build": {
    "dockerfile": "Dockerfile",
    "cacheFrom": [
      "type=local,src=.buildkit-cache"
    ],
    "cacheTo": "type=local,dest=.buildkit-cache,mode=max"
  },
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {},
    "ghcr.io/devcontainers/features/powershell:1": {
      "version": "latest"
    }
  },
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "pwsh",
        "powershell.startAutomatically": true,
        "terminal.integrated.env.linux": {
          "AI_TOOLS_PATH": "/shared/ai-tools",
          "MCP_TOOLS_PATH": "/shared/mcp-tools"
        },
        "editor.formatOnSave": true,
        "powershell.powerShellAdditionalExePaths": {
          "Preview": "/usr/bin/pwsh-preview"
        }
      },
      "extensions": [
        "ms-vscode.powershell",
        "eamodio.gitlens",
        "ms-azuretools.vscode-docker",
        "github.copilot",
        "github.copilot-chat",
        "ms-toolsai.jupyter",
        "sourcegraph.cody-ai",
        "redhat.vscode-yaml",
        "timonwong.shellcheck"
      ]
    }
  },
  "mounts": [
    "source=wsl2-dev-volume,target=/shared,type=volume"
  ],
  "remoteEnv": {
    "PATH": "${containerEnv:PATH}:/shared/bin",
    "POWERSHELL_TELEMETRY_OPTOUT": "1",
    "AI_TOOLS_PATH": "/shared/ai-tools",
    "MCP_TOOLS_PATH": "/shared/mcp-tools"
  },
  "postCreateCommand": "pwsh -File .devcontainer/devsetup.ps1",
  "remoteUser": "vscode",
  "runArgs": [
    "--init",
    "--cap-add=SYS_ADMIN",
    "--security-opt",
    "seccomp=unconfined",
    "--volume",
    "wsl2-dev-volume:/shared"
  ],
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
  "workspaceFolder": "/workspace"
}
